% ── Enhanced LaTeX styling for pandoc + xelatex ──────────────────────
% Makes the PDF body look closer to rendered markdown while preserving
% full LaTeX features (title page, headers, footers, TOC, etc.)

% ── Suppress pandoc auto-title (titlepage block is used instead) ──────
\renewcommand{\maketitle}{}

% ── Headers & Footers ─────────────────────────────────────
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{ifthen}
\setlength{\headheight}{36pt}   % Important when logo > 24pt
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
% \logopath, \headertext (and optionally \haslogo) must be defined
% before this file is loaded (via a prior -H include of paths.tex)
\fancyhead[L]{\ifdefined\haslogo\includegraphics[height=32pt]{\logopath}\fi}
\fancyhead[R]{\headertext}
\fancyfoot[C]{\thepage}
\pagestyle{fancy}
% Apply same style to 'plain' pages (TOC, title transitions)
\fancypagestyle{plain}{%
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \fancyhead[L]{\ifdefined\haslogo\includegraphics[height=32pt]{\logopath}\fi}
  \fancyhead[R]{\headertext}
  \fancyfoot[C]{\thepage}
}

% ── Colors ────────────────────────────────────────────────────────────
\usepackage{xcolor}
\definecolor{headingblue}{HTML}{0366d6}
\definecolor{codebg}{HTML}{f6f8fa}
\definecolor{blockquotegray}{HTML}{6a737d}
\definecolor{blockquoteborder}{HTML}{dfe2e5}
\definecolor{linkblue}{HTML}{0366d6}

% ── Hyperlinks ────────────────────────────────────────────────────────
\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=headingblue,
  urlcolor=linkblue,
  citecolor=headingblue,
  bookmarks=true,
  bookmarksnumbered=false,
  bookmarksopen=true,
  bookmarksopenlevel=2,
  pdfstartview=Fit,
  pdfpagemode=UseOutlines,
  linktoc=all,
}

% ── Headings (sized for professional tech PDF readability) ────────────
\usepackage{titlesec}
\titleformat{\section}
  {\fontsize{21}{25}\selectfont\bfseries\color{headingblue}}{}{0em}{}[\vspace{2pt}\titlerule]
\titleformat{\subsection}
  {\fontsize{17}{21}\selectfont\bfseries\color{headingblue}}{}{0em}{}
\titleformat{\subsubsection}
  {\fontsize{14.5}{18}\selectfont\bfseries\color{headingblue}}{}{0em}{}
\titleformat{\paragraph}[block]
  {\fontsize{13}{16}\selectfont\bfseries\color{headingblue}}{}{0em}{}
\titleformat{\subparagraph}[block]
  {\fontsize{12}{15}\selectfont\bfseries\color{headingblue}}{}{0em}{}

% Spacing: {left}{before}{after}[right]
\titlespacing*{\section}{0pt}{24pt plus 4pt minus 2pt}{12pt plus 2pt minus 2pt}
\titlespacing*{\subsection}{0pt}{20pt plus 4pt minus 2pt}{10pt plus 2pt minus 2pt}
\titlespacing*{\subsubsection}{0pt}{16pt plus 4pt minus 2pt}{8pt plus 2pt minus 2pt}
\titlespacing*{\paragraph}{0pt}{14pt plus 2pt minus 1pt}{8pt plus 2pt minus 1pt}
\titlespacing*{\subparagraph}{0pt}{12pt plus 2pt minus 1pt}{6pt plus 1pt minus 1pt}

% ── Code blocks (simple framed background) ────────────────────────────
% Override the Shaded environment that pandoc generates
\usepackage{framed}
\definecolor{shadecolor}{HTML}{f6f8fa}

% Code blocks: 10.5pt mono with automatic line-wrapping within margins
\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{fontsize=\fontsize{10.5}{13.5}\selectfont,breaklines=true,breakanywhere=true,commandchars=\\\{\}}

% Make inline code breakable at hyphens and allow generous line-breaking
\makeatletter
\def\verbatim@font{\normalfont\ttfamily\hyphenchar\font=45\relax}
\makeatother

% Redefine \texttt (pandoc inline code) to allow line breaks at /
% while correctly rendering LaTeX escapes (e.g. \{ → { , \} → } ).
% The previous \nolinkurl approach broke at / but printed \{ literally.
\let\OldTexttt\texttt
\makeatletter
% Internal loop: split at / and insert \allowbreak after each one
\def\@texttt@breakloop#1/#2\@nil{%
  #1%
  \ifx\relax#2\relax\else
    /\allowbreak
    \@texttt@breakloop#2\@nil
  \fi
}
\renewcommand{\texttt}[1]{%
  \begingroup
  \ttfamily
  \tolerance=9999\hbadness=10000\emergencystretch=3em
  \@texttt@breakloop#1/\@nil
  \endgroup
}
\makeatother

% ── Blockquotes ───────────────────────────────────────────────────────
\usepackage{mdframed}
\renewenvironment{quote}{%
  \begin{mdframed}[
    linewidth=3pt,
    linecolor=blockquoteborder,
    leftline=true,
    rightline=false,
    topline=false,
    bottomline=false,
    leftmargin=0pt,
    innerleftmargin=12pt,
    innerrightmargin=12pt,
    innertopmargin=8pt,
    innerbottommargin=8pt,
    skipabove=12pt,
    skipbelow=12pt,
  ]\color{blockquotegray}
}{%
  \end{mdframed}
}

% ── Tables (booktabs-like) ────────────────────────────────────────────
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{tabularx}

% Table spacing — keep tabcolsep tight so proportional columns have room
\setlength{\tabcolsep}{4pt}
\renewcommand{\arraystretch}{1.5}

% Wrapping column types
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}

% Default longtable positioning
\setlength\LTleft{0pt}
\setlength\LTright{0pt}
\setlength\LTpre{6pt}
\setlength\LTpost{6pt}

% Force pandoc longtables to use full page width and wrap cell content
\usepackage{calc}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
% Set table font to 10pt, ensure full-width columns, and allow text wrapping
\let\Oldlongtable\longtable
\let\endOldlongtable\endlongtable
\renewenvironment{longtable}{%
  \fontsize{10}{13}\selectfont
  \linewidth=\textwidth
  \sloppy
  \hbadness=10000
  \emergencystretch=2em
  \Oldlongtable
}{\endOldlongtable}
\makeatother

% ── Images ────────────────────────────────────────────────────────────
\usepackage{float}
\floatplacement{figure}{H}

% ── Lists – tighter spacing ──────────────────────────────────────────
\usepackage{enumitem}
\setlist{itemsep=2pt, parsep=2pt, topsep=4pt}

% ── Body line spacing & paragraph layout ─────────────────────────────
\linespread{1.45}   % 1.45× line-height for body text readability
\usepackage{parskip}
\setlength{\parindent}{0pt}
\setlength{\parskip}{10pt plus 3pt minus 2pt}

% ── TOC spacing ───────────────────────────────────────────────────────
% Add vertical space before each top-level section in the TOC
\usepackage{tocloft}
\setlength{\cftbeforesecskip}{6pt plus 2pt minus 1pt}
\setlength{\cftbeforesubsecskip}{2pt plus 1pt minus 0pt}
\setlength{\cftbeforesubsubsecskip}{1pt plus 1pt minus 0pt}
